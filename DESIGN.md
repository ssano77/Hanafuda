# こいこい ゲーム設計書

## 1. 概要

2人で遊ぶ花札のゲーム「こいこい」を実装するための設計書です。プレイヤーは12ヶ月（ラウンド）を通して、手札と山札から引いた札を場札と合わせることで役を作り、より多くの文（点数）を獲得することを目指します。

## 2. ゲームの構成要素

### 2.1. カード (Card)

花札48枚を表現します。各カードは以下の属性を持ちます。

-   **月 (Month):** 1月から12月
-   **種類 (Type):** `光`, `種`, `短冊`, `カス`
-   **名前 (Name):** "松に鶴", "梅に鶯" など
-   **画像パス (ImagePath):** カード画像を表示するためのパス

### 2.2. デッキ (Deck)

48枚のカードの集合を管理します。

-   **機能:**
    -   `シャッフル()`: 山札をランダムに並び替える。
    -   `カードを引く()`: 山札の上から1枚カードを取り出す。

### 2.3. プレイヤー (Player)

ゲームに参加するプレイヤー（2人）の状態を管理します。

-   **属性:**
    -   `名前 (Name)`: "プレイヤー1", "プレイヤー2" など
    -   `手札 (Hand)`: 手に持っているカードのリスト。
    -   `取得札 (CapturedCards)`: 獲得したカードのリスト。
    -   `合計点 (TotalScore)`: ゲーム全体で獲得した点数。
    -   `月ごとの点数 (MonthlyScore)`: 現在のラウンドで獲得した点数。
    -   `「こいこい」したか (HasKoikoied)`: こいこいを宣言したかどうかのフラグ。
    -   `親か (IsParent)`: 親プレイヤーかどうかのフラグ。

### 2.4. 場 (Field)

プレイヤーがカードを出す「場」を管理します。

-   **属性:**
    -   `場札 (CardsOnField)`: 場に出ているカードのリスト。

### 2.5. 役 (Yaku)

こいこいの役を定義します。

-   **属性:**
    -   `役の名前 (Name)`: "五光", "猪鹿蝶" など
    -   `点数 (Score)`
    -   `成立条件 (Condition)`: 役を構成するカードの組み合わせ。

## 3. ゲームフロー

### 3.1. 準備フェーズ

1.  **親決め:** プレイヤーのどちらかをランダムに「親」に決定します。
2.  **デッキの初期化:** 48枚のカードを持つデッキを生成し、シャッフルします。
3.  **札配り:**
    -   各プレイヤーに8枚ずつ手札を配ります。
    -   場に8枚のカードを表向きに置きます。
    -   残りのカードを山札とします。
4.  **初期役の確認:** この時点で役（手四、くっつき）が成立していた場合、ラウンドをやり直します。

### 3.2. プレイフェーズ (1ヶ月)

親プレイヤーから開始します。以下の手順をどちらかの手札がなくなるか、勝負がつくまで繰り返します。

1.  **手札選択:** プレイヤーは手札から1枚カードを選び、場に出します。
2.  **場札との照合 (手札):**
    -   場に同じ月のカードがあれば、出したカードと場にあったカードの2枚を取得できます。
    -   場に同じ月のカードがなければ、出したカードは場札に加わります。
3.  **山札から引く:** 山札から1枚カードを引いて、場に公開します。
4.  **場札との照合 (山札):**
    -   場に同じ月のカードがあれば、引いたカードと場にあったカードの2枚を取得できます。
    -   場に同じ月のカードがなければ、引いたカードは場札に加わります。
5.  **役判定:** カード取得後、自分の取得札で新たな役が成立したか判定します。
6.  **こいこい or 勝負:**
    -   役が成立した場合、プレイヤーは「こいこい」か「勝負（上がり）」を選択します。
        -   **勝負:** ラウンドを終了し、点数計算に移ります。
        -   **こいこい:** ラウンドを続行します。自分の役の点数は保持され、さらに高い役を目指せます。一度「こいこい」を宣言すると、同じラウンドで次に役が成立した際は自動的に「こいこい」状態となります。
    -   役が成立しない場合、または「こいこい」を選択した場合は、相手のターンに移ります。

### 3.3. 点数計算フェーズ

-   「勝負」が宣言されるとラウンドが終了し、上がったプレイヤーが成立した役の合計点を獲得します。
-   相手が「こいこい」を宣言していた場合、獲得点数は2倍になります。
-   獲得役の合計点が7文以上だった場合、獲得点数は2倍になります。
-   計算された点数を、上がったプレイヤーの合計点に加算します。
-   両プレイヤーの手札が尽きた場合（引き分け）は、親に6文が加算され、親のまま次のラウンドへ進みます。(ローカルルール)

### 3.4. 終了フェーズ

-   12ヶ月（12ラウンド）が終了した時点で、合計点が最も高いプレイヤーの勝利となります。
-   次の月では、前の月に上がったプレイヤーが「親」となります。

## 4. 役と点数一覧

| 役の名前     | 点数 | 構成条件                                       |
| :------------ | :--- | :--------------------------------------------- |
| **五光**      | 10点 | 光札 5枚                                       |
| **四光**      | 8点  | 光札 4枚 (柳に小野道風を含まない)              |
| **雨四光**    | 7点  | 光札 4枚 (柳に小野道風を含む)                  |
| **三光**      | 5点  | 光札 3枚 (柳に小野道風を含まない)              |
| **猪鹿蝶**    | 5点  | 萩に猪、紅葉に鹿、牡丹に蝶                     |
| **赤短**      | 5点  | 松、梅、桜の短冊                               |
| **青短**      | 5点  | 牡丹、菊、藤の短冊                             |
| **花見で一杯**| 5点  | 桜に幕、菊に盃                                 |
| **月見で一杯**| 5点  | 芒に月、菊に盃                                 |
| **たね**      | 1点+ | 種札 5枚。以降1枚増えるごとに+1点              |
| **たん**      | 1点+ | 短冊札 5枚。以降1枚増えるごとに+1点            |
| **かす**      | 1点+ | カス札 10枚。以降1枚増えるごとに+1点           |
